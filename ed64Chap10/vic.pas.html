<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
	color: #808080;
}
.sc2 {
	font-size: 8pt;
	color: #008000;
}
.sc3 {
	font-size: 8pt;
	color: #008080;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	color: #808080;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc3">(*****************************************************************
* ED64 : EL DENDO's Commodore 64 emulator                        *
* VIC emulation unit                                             *
* (c) 2006 - 2009 by ir. Marc Dendooven                          *
* Versie Chapter 10                                              *
*****************************************************************)</span><span class="sc0">

</span><span class="sc5">Unit</span><span class="sc0"> </span><span class="sc11">vic</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc3">(****************************************************************)</span><span class="sc0">
</span><span class="sc5">interface</span><span class="sc0">

</span><span class="sc5">uses</span><span class="sc0"> </span><span class="sc11">SystemAbstraction</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">vicVMupdate</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">vicPMupdate</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0">  </span><span class="sc11">vicRead</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">vicWrite</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">colorWrite</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">color</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">nibble</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0">  </span><span class="sc11">colorRead</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">nibble</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">vicBank</span><span class="sc10">(</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc3">(****************************************************************)</span><span class="sc0">

</span><span class="sc5">implementation</span><span class="sc0">

</span><span class="sc5">uses</span><span class="sc0"> </span><span class="sc11">memio</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">const</span><span class="sc0"> </span><span class="sc11">CMbase</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$D800</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">SCM</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$00</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">MCCM</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$10</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">ECCM</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$40</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">SBMM</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$20</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">MCBMM</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$30</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">var</span><span class="sc0">
    </span><span class="sc11">bankAddress</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">VMbase</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">PMbase</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">reg</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc10">[</span><span class="sc4">$D000</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">$D02E</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">color_ram</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc10">[</span><span class="sc4">$D800</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">$DBFF</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">nibble</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">bmm</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">boolean</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">vidMode</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$00</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">PMlenght</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1999</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">refresh</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">999</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc11">poke</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">VMbase</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc11">peek</span><span class="sc10">(</span><span class="sc11">VMbase</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">))</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">setVicValues</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
        </span><span class="sc11">vidMode</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D011</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$60</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">or</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D016</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$10</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc3">(*      case vidMode of
            SCM    : writeln ('video mode : SCM');
            MCCM   : writeln ('video mode : MCCM');
            ECCM   : writeln ('video mode : ECCM');
            SBMM   : writeln ('video mode : SBMM');
            MCBMM  : writeln ('video mode : MCBMM')
        end;   *)</span><span class="sc0">
        </span><span class="sc11">bmm</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">boolean</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">vidmode</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$20</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">VMbase</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">bankAddress</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D018</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)*</span><span class="sc4">$400</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">bmm</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">begin</span><span class="sc0">
                        </span><span class="sc11">PMbase</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">bankAddress</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D018</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$08</span><span class="sc10">)*</span><span class="sc4">$400</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">PMlenght</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">7999</span><span class="sc0">
                     </span><span class="sc5">end</span><span class="sc0">
               </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">begin</span><span class="sc0">
                        </span><span class="sc11">PMbase</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">bankAddress</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D018</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$0E</span><span class="sc10">)*</span><span class="sc4">$400</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">PMlenght</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">1999</span><span class="sc0">
                     </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setVicVMwatchRange</span><span class="sc10">(</span><span class="sc11">VMbase</span><span class="sc10">,</span><span class="sc11">VMbase</span><span class="sc10">+</span><span class="sc4">999</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">setVicPMwatchRange</span><span class="sc10">(</span><span class="sc11">PMbase</span><span class="sc10">,</span><span class="sc11">PMbase</span><span class="sc10">+</span><span class="sc11">PMlenght</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//       refresh</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">vicBank</span><span class="sc10">(</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc11">bankAddress</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc10">(</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc4">$4000</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">setVicValues</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">colorWrite</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">color</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">nibble</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc11">color_ram</span><span class="sc10">[</span><span class="sc11">address</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">color</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">vicVMupdate</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">-</span><span class="sc11">CMbase</span><span class="sc10">,</span><span class="sc11">peek</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">-</span><span class="sc11">CMbase</span><span class="sc10">+</span><span class="sc11">VMbase</span><span class="sc10">))</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">colorRead</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">nibble</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc11">colorRead</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">color_ram</span><span class="sc10">[</span><span class="sc11">address</span><span class="sc10">]</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">function</span><span class="sc0">  </span><span class="sc11">vicRead</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0">
        </span><span class="sc4">$D012</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">vicRead</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">$00</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">//raster</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc11">vicRead</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc11">address</span><span class="sc10">]</span><span class="sc0">
    </span><span class="sc5">end</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">vicWrite</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc11">address</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">setVicValues</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">updateSCM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">x0</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">,</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y</span><span class="sc10">:</span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
       </span><span class="sc11">x0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">y0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">:=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
          </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
             </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">boolean</span><span class="sc10">(</span><span class="sc11">vicPeek</span><span class="sc10">(</span><span class="sc11">PMbase</span><span class="sc10">+</span><span class="sc11">val</span><span class="sc10">*</span><span class="sc4">8</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">$80</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">))</span><span class="sc0">
                   </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">color_ram</span><span class="sc10">[</span><span class="sc11">CMbase</span><span class="sc10">+</span><span class="sc11">pos</span><span class="sc10">])</span><span class="sc0">
                   </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D021</span><span class="sc10">])</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">updateECCM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">x0</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">,</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y</span><span class="sc10">:</span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bg</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
       </span><span class="sc11">x0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">y0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">bg</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$C0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$3F</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">:=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
          </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
             </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">boolean</span><span class="sc10">(</span><span class="sc11">vicPeek</span><span class="sc10">(</span><span class="sc11">PMbase</span><span class="sc10">+</span><span class="sc11">val</span><span class="sc10">*</span><span class="sc4">8</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">$80</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">))</span><span class="sc0">
                   </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">color_ram</span><span class="sc10">[</span><span class="sc11">CMbase</span><span class="sc10">+</span><span class="sc11">pos</span><span class="sc10">])</span><span class="sc0">
                   </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D021</span><span class="sc10">+</span><span class="sc11">bg</span><span class="sc10">])</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">updateMCCM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">x0</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">,</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y</span><span class="sc10">:</span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">boolean</span><span class="sc10">(</span><span class="sc11">color_ram</span><span class="sc10">[</span><span class="sc11">CMbase</span><span class="sc10">+</span><span class="sc11">pos</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$8</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">then</span><span class="sc0">
            </span><span class="sc5">begin</span><span class="sc0">
                </span><span class="sc11">x0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">y0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">:=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
                    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
                        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">vicPeek</span><span class="sc10">(</span><span class="sc11">PMbase</span><span class="sc10">+</span><span class="sc11">val</span><span class="sc10">*</span><span class="sc4">8</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">*((</span><span class="sc4">7</span><span class="sc10">-</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0">
                            </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D021</span><span class="sc10">]);</span><span class="sc0">
                            </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D022</span><span class="sc10">]);</span><span class="sc0">
                            </span><span class="sc4">2</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D023</span><span class="sc10">]);</span><span class="sc0">
                            </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">color_ram</span><span class="sc10">[</span><span class="sc11">CMbase</span><span class="sc10">+</span><span class="sc11">pos</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$7</span><span class="sc10">)</span><span class="sc0">
                        </span><span class="sc5">end</span><span class="sc0">
            </span><span class="sc5">end</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">updateSCM</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">updateSBMM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">x0</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">,</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y</span><span class="sc10">:</span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
       </span><span class="sc11">x0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">y0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">:=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
          </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
             </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">boolean</span><span class="sc10">(</span><span class="sc11">vicPeek</span><span class="sc10">(</span><span class="sc11">PMbase</span><span class="sc10">+</span><span class="sc11">pos</span><span class="sc10">*</span><span class="sc4">8</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">$80</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">))</span><span class="sc0">
                   </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,(</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$F0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0">
                   </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$0F</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">updateMCBMM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">x0</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">,</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y</span><span class="sc10">:</span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
        </span><span class="sc11">x0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">y0</span><span class="sc10">:=(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)*</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">:=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
           </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
              </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">vicPeek</span><span class="sc10">(</span><span class="sc11">PMbase</span><span class="sc10">+</span><span class="sc11">pos</span><span class="sc10">*</span><span class="sc4">8</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">*((</span><span class="sc4">7</span><span class="sc10">-</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0">
                            </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">reg</span><span class="sc10">[</span><span class="sc4">$D021</span><span class="sc10">]);</span><span class="sc0">
                            </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,(</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$F0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc4">2</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$0F</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">setPixel</span><span class="sc10">(</span><span class="sc11">x0</span><span class="sc10">+</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y0</span><span class="sc10">+</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">color_ram</span><span class="sc10">[</span><span class="sc11">CMbase</span><span class="sc10">+</span><span class="sc11">pos</span><span class="sc10">])</span><span class="sc0">
              </span><span class="sc5">end</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">vicVMupdate</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">vidMode</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0">
        </span><span class="sc11">SCM</span><span class="sc0">  </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">updateSCM</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">MCCM</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">updateMCCM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">ECCM</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">updateECCM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">SBMM</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">updateSBMM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">MCBMM</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">updateMCBMM</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc11">aWriteLn</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc7">'WARNING: Undefined Video Mode !'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">end</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">vicPMupdate</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">bmm</span><span class="sc0">  </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">vicVMupdate</span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vicPeek</span><span class="sc10">(</span><span class="sc11">VMbase</span><span class="sc10">+(</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)))</span><span class="sc0">
        </span><span class="sc2">//       else refresh;</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">end.</span><span class="sc0">
</span></div></body>
</html>
